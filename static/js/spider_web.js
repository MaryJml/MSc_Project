const sorted_timeline_data = {'02008354': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 2590'], 'start_time': '1476'}, {'owner_names': ['Owner ID: 00013191'], 'start_time': '1789'}, {'owner_names': ['Owner ID: 00014395'], 'start_time': '1792'}, {'owner_names': ['Owner ID: 2699', 'Owner ID: 00016201'], 'start_time': '1892'}, {'owner_names': ['Owner ID: 00016201'], 'start_time': 'Unknown'}], '02006747': [{'owner_names': ['Owner ID: 2590'], 'start_time': '1470'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1470'}, {'owner_names': ['Owner ID: 00020986'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 0011046'], 'start_time': '1873'}, {'owner_names': ['Owner ID: 3331'], 'start_time': '1945'}, {'owner_names': ['Owner ID: 00015680', 'Owner ID: 3442'], 'start_time': '1986'}], '00200404': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 2590'], 'start_time': '1470'}, {'owner_names': ['Owner ID: 00020986'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 00011615'], 'start_time': '1814'}, {'owner_names': ['Owner ID: 00010187'], 'start_time': '1841'}, {'owner_names': ['Owner ID: 2381'], 'start_time': '2013'}], '02008357': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 2590'], 'start_time': '1476'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}, {'owner_names': ['Owner ID: 3479'], 'start_time': '1816'}], '02008207': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 2590'], 'start_time': '1469'}, {'owner_names': ['Owner ID: 819'], 'start_time': '1701'}, {'owner_names': ['Owner ID: 2734'], 'start_time': '1721'}], '02107092': [{'owner_names': ['Owner ID: 2590', 'Owner ID: 00025457'], 'start_time': 1460}, {'owner_names': ['Owner ID: 3467'], 'start_time': 1500}, {'owner_names': ['Owner ID: 00015143'], 'start_time': 1797}, {'owner_names': ['Owner ID: 2839'], 'start_time': 1815}], '02011874': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 2590'], 'start_time': '1476'}, {'owner_names': ['Owner ID: 00014883'], 'start_time': '1797'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1809'}], '02008198': [{'owner_names': ['Owner ID: 1625', 'Owner ID: 2156'], 'start_time': '1498'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1513'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1811'}, {'owner_names': ['Owner ID: 00021806'], 'start_time': '1820'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1840'}], '02014753': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1486}, {'owner_names': ['Owner ID: 00015143'], 'start_time': 1797}, {'owner_names': ['Owner ID: 3479'], 'start_time': 1815}], '02006857': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1476'}, {'owner_names': ['Owner ID: 4085'], 'start_time': '1501'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02019758': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1488'}, {'owner_names': ['Owner ID: 3483'], 'start_time': '1701'}, {'owner_names': ['Owner ID: 3479'], 'start_time': '1810'}], '02019757': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1488'}, {'owner_names': ['Owner ID: 3483'], 'start_time': '1701'}, {'owner_names': ['Owner ID: 3479'], 'start_time': '1810'}], '02019759': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1488'}, {'owner_names': ['Owner ID: 3483'], 'start_time': '1701'}, {'owner_names': ['Owner ID: 3479'], 'start_time': '1810'}], '02019761': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1488'}, {'owner_names': ['Owner ID: 3483'], 'start_time': '1701'}, {'owner_names': ['Owner ID: 3479'], 'start_time': '1810'}], '02006706': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1811'}], '02008341': [{'owner_names': ['Owner ID: 1904', 'Owner ID: 3467'], 'start_time': '1492'}, {'owner_names': ['Owner ID: 4085'], 'start_time': '1810'}, {'owner_names': ['Owner ID: 00021806'], 'start_time': '1820'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1840'}], '02008360': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1477'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02137940': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1490'}], '02011873': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1786'}, {'owner_names': ['Owner ID: 4240'], 'start_time': '1786'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1802'}], '02127882': [{'owner_names': ['Owner ID: 1625'], 'start_time': '1500'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1513'}, {'owner_names': ['Owner ID: 00010583'], 'start_time': '1701'}, {'owner_names': ['Owner ID: 2832'], 'start_time': '1800'}], '02006673': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1811'}], '02008331': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1500'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02007041': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02008348': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1475'}, {'owner_names': ['Owner ID: 3479'], 'start_time': '1701'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02108478': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1483}], '02125177': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1493'}, {'owner_names': ['Owner ID: 00023820'], 'start_time': '1600'}, {'owner_names': ['Owner ID: 00016901'], 'start_time': '1501'}, {'owner_names': ['Owner ID: 00017969'], 'start_time': '1651'}, {'owner_names': ['Owner ID: 00016355'], 'start_time': '1700'}], '02018099': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1495}, {'owner_names': ['Owner ID: 00017138'], 'start_time': 1806}], '02006674': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02018162': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1483}, {'owner_names': ['Owner ID: 00017138'], 'start_time': 1806}, {'owner_names': ['Owner ID: 1408'], 'start_time': 1806}], '02108479': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1493}], '02018176': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1490'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02018166': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1481'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02018102': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1494}], '02125145': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1492'}, {'owner_names': ['Owner ID: 00023820'], 'start_time': '1600'}, {'owner_names': ['Owner ID: 00022791'], 'start_time': '1601'}, {'owner_names': ['Owner ID: 00017969'], 'start_time': '1651'}, {'owner_names': ['Owner ID: 00016355'], 'start_time': '1700'}], '02003644': [{'owner_names': ['Owner ID: 901'], 'start_time': '1501'}, {'owner_names': ['Owner ID: 3467', 'Owner ID: 00016768'], 'start_time': '1601'}, {'owner_names': ['Owner ID: 00010056'], 'start_time': '1806'}], '02008343': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1496'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02018106': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1495}], '02008359': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1483'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02008611': [{'owner_names': ['Owner ID: 1625'], 'start_time': 'Unknown'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1513'}, {'owner_names': ['Owner ID: 3601'], 'start_time': '1888'}, {'owner_names': ['Owner ID: 1471'], 'start_time': '1958'}], '02108480': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1475}], '02017432': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1495'}, {'owner_names': ['Owner ID: 4073'], 'start_time': '1886'}, {'owner_names': ['Owner ID: 3463'], 'start_time': '1886'}], '02008246': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1499'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02006700': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02008353': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 2699'], 'start_time': '1899'}, {'owner_names': ['Owner ID: 00016201'], 'start_time': '1899'}], '02108481': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1492}], '02019417': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1471'}], '02008197': [{'owner_names': ['Owner ID: 1861', 'Owner ID: 3467'], 'start_time': '1497'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1801'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02008218': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1801'}], '02018170': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1485'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1811'}], '02108482': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1471'}, {'owner_names': ['Owner ID: 00020986'], 'start_time': '1806'}], '02008350': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1478'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1801'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02008264': [{'owner_names': ['Owner ID: 1875'], 'start_time': '1491'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1801'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02006705': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1801'}], '02145483': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1491'}], '00202002': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1500'}, {'owner_names': ['Owner ID: 694'], 'start_time': '1700'}, {'owner_names': ['Owner ID: 00011037'], 'start_time': '1797'}], '02018218': [{'owner_names': ['Owner ID: 1625'], 'start_time': '1493'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1513'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1807'}, {'owner_names': ['Owner ID: 00021806'], 'start_time': '1818'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1840'}], '02008328': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1492'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02008329': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1492'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02011875': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1806'}], '02008355': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1789'}, {'owner_names': ['Owner ID: 00024367'], 'start_time': '1898'}], '02006835': [{'owner_names': ['Owner ID: 1645'], 'start_time': '1581'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1601'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1801'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02108483': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1499'}], '02006694': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '00214233': [{'owner_names': ['Owner ID: 00021323'], 'start_time': 1478}, {'owner_names': ['Owner ID: 3467'], 'start_time': 1478}, {'owner_names': ['Owner ID: 00015143', 'Owner ID: 4204'], 'start_time': 1797}, {'owner_names': ['Owner ID: 4209'], 'start_time': 1824}], '02011876': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1500'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02108484': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1477}], '02018188': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 00017138'], 'start_time': '1484'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02016845': [{'owner_names': ['Owner ID: 00010351'], 'start_time': 1471}, {'owner_names': ['Owner ID: 3467', 'Owner ID: 00010413'], 'start_time': 1471}, {'owner_names': ['Owner ID: 00015143'], 'start_time': 1797}, {'owner_names': ['Owner ID: 3479'], 'start_time': 1816}], '02018214': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 00017138'], 'start_time': '1480'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02008361': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1471'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02006698': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02011878': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1461'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02006764': [{'owner_names': ['Owner ID: 1639', 'Owner ID: 3549'], 'start_time': '1491'}, {'owner_names': ['Owner ID: 1638', 'Owner ID: 3467'], 'start_time': '1740'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02006685': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02006683': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408', 'Owner ID: 00021806'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 00036743'], 'start_time': '1859'}, {'owner_names': ['Owner ID: 00016113'], 'start_time': '1957'}], '02018229': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1475}, {'owner_names': ['Owner ID: 00015143'], 'start_time': 1797}], '02018221': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 00017138'], 'start_time': '1491'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02018108': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1495}], '02018180': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 00017138'], 'start_time': '1484'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02017463': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1500}, {'owner_names': ['Owner ID: 00016568'], 'start_time': 1658}, {'owner_names': ['Owner ID: 00016569'], 'start_time': 1698}, {'owner_names': ['Owner ID: 00015181'], 'start_time': 1703}, {'owner_names': ['Owner ID: 00015179'], 'start_time': 1785}], '02006695': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02017555': [{'owner_names': ['Owner ID: 901'], 'start_time': '1496'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1601'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02006702': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02015857': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1550'}, {'owner_names': ['Owner ID: 3479'], 'start_time': '1797'}, {'owner_names': ['Owner ID: 2832'], 'start_time': '1807'}], '02017597': [{'owner_names': ['Owner ID: 4085'], 'start_time': '1485'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1601'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1796'}], '02108485': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1472}, {'owner_names': ['Owner ID: 00020986'], 'start_time': 1806}], '02018192': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1488}, {'owner_names': ['Owner ID: 00017138'], 'start_time': 1806}, {'owner_names': ['Owner ID: 1408'], 'start_time': 1806}], '02018168': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1491'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02006704': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02003446': [{'owner_names': ['Owner ID: 901'], 'start_time': 1500}, {'owner_names': ['Owner ID: 3467', 'Owner ID: 00016768'], 'start_time': 1601}, {'owner_names': ['Owner ID: 00010056'], 'start_time': 1806}], '02003447': [{'owner_names': ['Owner ID: 00015557'], 'start_time': '1498'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1600'}, {'owner_names': ['Owner ID: 43'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 00010056'], 'start_time': '1863'}], '02008356': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1475'}, {'owner_names': ['Owner ID: 00024367'], 'start_time': '1789'}], '02008239': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02017398': [{'owner_names': ['Owner ID: 00021391'], 'start_time': '1489'}, {'owner_names': ['Owner ID: 00016518'], 'start_time': '1490'}, {'owner_names': ['Owner ID: 00010673'], 'start_time': '1529'}, {'owner_names': ['Owner ID: 00016540'], 'start_time': '1653'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1653'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}, {'owner_names': ['Owner ID: 3479'], 'start_time': '1815'}], '02006707': [{'owner_names': ['Owner ID: 1625'], 'start_time': '1498'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1513'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02018104': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1480}], '02020126': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1485'}, {'owner_names': ['Owner ID: 00018017', 'Owner ID: 00018018'], 'start_time': '1740'}, {'owner_names': ['Owner ID: 00017097'], 'start_time': '1875'}, {'owner_names': ['Owner ID: 2325'], 'start_time': '1920'}, {'owner_names': ['Owner ID: 138'], 'start_time': '1960'}], '02108486': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1497}], '02006697': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02018230': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1480'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02006689': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02008344': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1475'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02018215': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1489'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02139823': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1797'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02008266': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1499'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02017486': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1472'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02139822': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1797'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02006856': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1475'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02137942': [{'owner_names': ['Owner ID: 1645'], 'start_time': '1581'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1626'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02008265': [{'owner_names': ['Owner ID: 1875'], 'start_time': '1491'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 00021806'], 'start_time': '1813'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1813'}], '02006703': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02018220': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1494'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02008330': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1500'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02139835': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}], '02008346': [{'owner_names': ['Owner ID: 00017050'], 'start_time': '1478'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1600'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02127999': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1478'}, {'owner_names': ['Owner ID: 4453'], 'start_time': '1806'}], '02139836': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}], '02014160': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1700'}, {'owner_names': ['Owner ID: 694'], 'start_time': '1701'}, {'owner_names': ['Owner ID: 00011037'], 'start_time': '1797'}], '02015563': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1471'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1893'}, {'owner_names': ['Owner ID: 00015896'], 'start_time': '1901'}], '02006688': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1810'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1801'}], '02008332': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1479'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02006855': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02017598': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1500'}, {'owner_names': ['Owner ID: 00016832'], 'start_time': '1806'}], '02137941': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1490'}], '02126740': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1501}, {'owner_names': ['Owner ID: 2640'], 'start_time': 1800}, {'owner_names': ['Owner ID: 00023301'], 'start_time': 1850}], '02006679': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1489'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 00016834'], 'start_time': '1811'}], '02017605': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1477'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02008268': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1499'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02006699': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1810'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02108487': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1484}], '02018225': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1492'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1820'}], '02017608': [{'owner_names': ['Owner ID: 1625'], 'start_time': '1498'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1513'}, {'owner_names': ['Owner ID: 4603'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 00016835'], 'start_time': '1946'}, {'owner_names': ['Owner ID: 00016836'], 'start_time': '2017'}], '02006676': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1472'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1813'}, {'owner_names': ['Owner ID: 00014566'], 'start_time': '1831'}, {'owner_names': ['Owner ID: 4209'], 'start_time': '1831'}], '02017609': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1479'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02017610': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1491'}, {'owner_names': ['Owner ID: 00012294'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3445'], 'start_time': '1830'}, {'owner_names': ['Owner ID: 3331'], 'start_time': '1965'}], '00209908': [{'owner_names': ['Owner ID: 1625'], 'start_time': '1499'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1513'}, {'owner_names': ['Owner ID: 3281'], 'start_time': '1956'}, {'owner_names': ['Owner ID: 4209'], 'start_time': '1956'}], '02018222': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1489'}, {'owner_names': ['Owner ID: 00017138'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02017611': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1476'}, {'owner_names': ['Owner ID: 3042'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3523'], 'start_time': '1841'}], '02018231': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1492'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02017613': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1476'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1797'}], '02108488': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1471}, {'owner_names': ['Owner ID: 00020986'], 'start_time': 1806}], '02006693': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02008349': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1496'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02108490': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1468}], '02018103': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1482}], '02007068': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02006687': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02006696': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02139534': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 4751', 'Owner ID: 00029275'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 00029274', 'Owner ID: 00029275'], 'start_time': '1824'}], '02108491': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1482}], '02006701': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}], '02008269': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1499'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02017614': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1472'}, {'owner_names': ['Owner ID: 00013191'], 'start_time': '1789'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1792'}], '02002784': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1493'}, {'owner_names': ['Owner ID: 00010056'], 'start_time': '1806'}], '02008199': [{'owner_names': ['Owner ID: 1625'], 'start_time': '1494'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1513'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '00200283': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 2334'], 'start_time': 1499}, {'owner_names': ['Owner ID: 00010061'], 'start_time': 1557}, {'owner_names': ['Owner ID: 00010062'], 'start_time': 1601}, {'owner_names': ['Owner ID: 1180'], 'start_time': 1770}, {'owner_names': ['Owner ID: 00010035'], 'start_time': 1810}], '02122654': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1490'}, {'owner_names': ['Owner ID: 4086'], 'start_time': '1573'}, {'owner_names': ['Owner ID: 00010352'], 'start_time': '1725'}, {'owner_names': ['Owner ID: 3479', 'Owner ID: 4016', 'Owner ID: 1112'], 'start_time': '1801'}], '02128491': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1499'}], '02108493': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1488}], '02008347': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 00023096'], 'start_time': '1471'}, {'owner_names': ['Owner ID: 00013191'], 'start_time': '1789'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1792'}], '02139533': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 00029274', 'Owner ID: 00029275'], 'start_time': '1816'}], '02019418': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1474'}], '02008335': [{'owner_names': ['Owner ID: 3230'], 'start_time': '1550'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1566'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1806'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02108495': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1471}, {'owner_names': ['Owner ID: 00020986'], 'start_time': 1806}], '02017615': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1471'}, {'owner_names': ['Owner ID: 00013191'], 'start_time': '1789'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1792'}], '02141391': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1765'}], '02018105': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1497}], '02108496': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1476}], '02019400': [{'owner_names': ['Owner ID: 00010673'], 'start_time': '1525'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1600'}, {'owner_names': ['Owner ID: 2678'], 'start_time': '1820'}, {'owner_names': ['Owner ID: 3551'], 'start_time': '1868'}], '02107193': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1481'}, {'owner_names': ['Owner ID: 00016556'], 'start_time': '1628'}, {'owner_names': ['Owner ID: 2839'], 'start_time': '1773'}], '02017632': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1484'}, {'owner_names': ['Owner ID: 00015156'], 'start_time': '1806'}], '00206141': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1480'}, {'owner_names': ['Owner ID: 00013839'], 'start_time': '1750'}, {'owner_names': ['Owner ID: 4209', 'Owner ID: 00012182'], 'start_time': '1789'}], '02009688': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1481'}, {'owner_names': ['Owner ID: 3466'], 'start_time': '1660'}, {'owner_names': ['Owner ID: 3458'], 'start_time': '1660'}, {'owner_names': ['Owner ID: 2169', 'Owner ID: 2156'], 'start_time': '1848'}, {'owner_names': ['Owner ID: 00028245'], 'start_time': '1890'}], '02018224': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1494}, {'owner_names': ['Owner ID: 00017138'], 'start_time': 1806}, {'owner_names': ['Owner ID: 1408'], 'start_time': 1806}, {'owner_names': ['Owner ID: 3765'], 'start_time': 1820}], '02018101': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1488}], '02125175': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1493'}, {'owner_names': ['Owner ID: 00023820'], 'start_time': '1600'}, {'owner_names': ['Owner ID: 00016901'], 'start_time': '1501'}, {'owner_names': ['Owner ID: 00017969'], 'start_time': '1651'}, {'owner_names': ['Owner ID: 00016355'], 'start_time': '1700'}], '02008352': [{'owner_names': ['Owner ID: 3467', 'Owner ID: 00016952'], 'start_time': '1800'}, {'owner_names': ['Owner ID: 00015143'], 'start_time': '1806'}], '02006771': [{'owner_names': ['Owner ID: 1409'], 'start_time': '1500'}, {'owner_names': ['Owner ID: 3467'], 'start_time': '1601'}, {'owner_names': ['Owner ID: 1408'], 'start_time': '1801'}, {'owner_names': ['Owner ID: 3765'], 'start_time': '1811'}], '02108489': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1500'}, {'owner_names': ['Owner ID: 1677'], 'start_time': '1789'}, {'owner_names': ['Owner ID: 2141'], 'start_time': '1797'}], '02126715': [{'owner_names': ['Owner ID: 3467'], 'start_time': '1472'}, {'owner_names': ['Owner ID: 2832'], 'start_time': '1800'}], '02108492': [{'owner_names': ['Owner ID: 3467'], 'start_time': 1492}]};

// 获取复选框元素
const showOwnersCheckbox = document.getElementById('showOwnersCheckbox');

// 准备一个颜色映射
const ownerColorScale = d3.scaleOrdinal(d3.schemeCategory10);
const ownerSet = new Set();
Object.values(sorted_timeline_data).forEach(events => {
    events.forEach(event => {
        event.owner_names.forEach(owner => ownerSet.add(owner));
    });
});
ownerColorScale.domain(Array.from(ownerSet));

// 为复选框添加事件监听器
showOwnersCheckbox.addEventListener('change', function() {
    if (this.checked) {
        // 如果复选框被勾选，根据所有者设置圆圈的颜色
        webSvg.selectAll('circle')
            .attr('fill', function(d) {
                return ownerColorScale(d.owner_names[0]);
            });
    } else {
        // 如果复选框未被勾选，恢复圆圈的默认颜色
        webSvg.selectAll('circle')
            .attr('fill', function(d) {
                return d.owner_names.includes('Owner ID: 3467') ? 'red' : 'blue';
            });
    }
});

const showSameOwnersCheckbox = document.getElementById('showSameOwnersCheckbox');
const ownerCheckboxesContainer = document.getElementById('ownerCheckboxes');
const ownerSearchBar = document.getElementById('ownerSearchBar');
const selectAllButton = document.getElementById('webSelectAll');
const deselectAllButton = document.getElementById('webDeselectAll');

// 初始化函数
function initialize() {

    // 根据 showSameOwnersCheckbox 的状态设置 ownerCheckboxes 的显示
    ownerCheckboxesContainer.style.display = showSameOwnersCheckbox.checked ? 'block' : 'none';

    Array.from(ownerSet).forEach(owner => {
        const checkboxDiv = document.createElement('div');

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = `checkbox-${owner}`;
        checkbox.checked = true;
        checkbox.setAttribute('data-owner', owner);

        const label = document.createElement('label');
        label.htmlFor = `checkbox-${owner}`;
        label.appendChild(document.createTextNode(owner));

        checkboxDiv.appendChild(checkbox);
        checkboxDiv.appendChild(label);
        ownerCheckboxesContainer.appendChild(checkboxDiv);
    });


    ownerCheckboxesContainer.addEventListener('change', function(event) {
        if (event.target.type === 'checkbox') {
            const owner = event.target.getAttribute('data-owner');
            const isChecked = event.target.checked;

            // 更新对应所有者连线的透明度
            d3.selectAll('.linkSameOwner')
                .filter(function() { return this.getAttribute('data-owner') === owner; })
                .style('opacity', isChecked ? 0.5 : 0)
                .style('pointer-events', this.checked ? 'all' : 'none');
        }
    });

    showSameOwnersCheckbox.addEventListener('change', function() {
        ownerCheckboxesContainer.style.display = this.checked ? 'block' : 'none';
        ownerSearchBar.style.display = this.checked ? 'block' : 'none';
        selectAllButton.style.display = this.checked ? 'block' : 'none';
        deselectAllButton.style.display = this.checked ? 'block' : 'none';

        // 在隐藏复选框时重置所有连线的透明度
        if (!this.checked) {
            d3.selectAll('.linkSameOwner')
                .style('opacity', 0)
                .style('pointer-events', this.checked ? 'all' : 'none');
        }
    });


    ownerSearchBar.addEventListener('input', function() {
        const searchText = this.value.toLowerCase();
        Array.from(ownerCheckboxesContainer.children).forEach(div => {
            // 假设每个 div 包含一个复选框和一个 label
            if (div.querySelector('label').textContent.toLowerCase().includes(searchText)) {
                div.style.display = 'block';
            } else {
                div.style.display = 'none';
            }
        });
    });

    selectAllButton.addEventListener('click', () => {
        // 全选所有复选框
        Array.from(ownerCheckboxesContainer.querySelectorAll('input[type="checkbox"]')).forEach(checkbox => {
            checkbox.checked = true;
        });

        // 显示所有相关连线
        if (showSameOwnersCheckbox.checked) {
            d3.selectAll('.linkSameOwner').style('opacity', 0.5);
        }
    });

    deselectAllButton.addEventListener('click', () => {
        // 取消全选所有复选框
        Array.from(ownerCheckboxesContainer.querySelectorAll('input[type="checkbox"]')).forEach(checkbox => {
            checkbox.checked = false;
        });

        // 隐藏所有相关连线
        if (showSameOwnersCheckbox.checked) {
            d3.selectAll('.linkSameOwner').style('opacity', 0);
        }
    });

    const toggleDataCheckbox = document.getElementById('toggleArrangedDataCheckbox');

    drawTimelines(sorted_timeline_data);
    toggleDataCheckbox.addEventListener('change', function() {
        if (this.checked) {
            // 如果复选框被勾选，显示排列好的数据
            drawTimelines(sorted_timeline_data);
        } else {
            // 如果复选框未被勾选，显示原始数据
            drawTimelines(timeline_data);
        }
    });
}


// 添加事件监听器以响应复选框的变化
showSameOwnersCheckbox.addEventListener('change', function() {
    if (this.checked) {
        d3.selectAll('.linkSameOwner').style('opacity', 0.5);
    } else {
        d3.selectAll('.linkSameOwner').style('opacity', 0);
    }
});

// 获取复选框元素
const showYearsCheckbox = document.getElementById('showYearsCheckbox');

// 添加事件监听器以响应复选框的变化
showYearsCheckbox.addEventListener('change', function() {
    if (this.checked) {
        d3.selectAll('.timeline-text').style('opacity', 1); // 显示所有年份
    } else {
        d3.selectAll('.timeline-text').style('opacity', 0); // 隐藏所有年份
    }
});

const yearDiffs = [];
Object.values(sorted_timeline_data).forEach(events => {
    for (let i = 0; i < events.length - 1; i++) {
        if (events[i].start_time !== 'Unknown' && events[i + 1].start_time !== 'Unknown') {
            const diff = Math.abs(events[i + 1].start_time - events[i].start_time);
            yearDiffs.push(diff);
        }
    }
});

const minYearDiff = d3.min(yearDiffs);
const maxYearDiff = d3.max(yearDiffs);

const UnknownLength = 80;

const yearScale = d3.scaleLinear()
    .domain([minYearDiff, maxYearDiff])
    .range([80, 200]);

const webWidth = 800;
const webHeight = 1000;

const webSvg = d3.select('#web')
    .attr('width', webWidth)
    .attr('height', webHeight);

const center = { x: webWidth / 2, y: webHeight / 2 };

const webTooltip = d3.select('body').append('div')
    .attr('class', 'tooltip')
    .style('position', 'absolute')
    .style('visibility', 'hidden')
    .style('background-color', 'white')
    .style('padding', '5px')
    .style('border-radius', '5px')
    .style('border', '1px solid black');

const centerPadding = 50;



// 计算两点之间的距离
function distance(a, b) {
    return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));
}

function drawTimelines(data) {
    const ownerLocations = {};
    webSvg.selectAll("*").remove();

    const timelines = Object.keys(data).map(bookId => {
        const events = data[bookId];
        const centerIndex = events.findIndex(event => event.owner_names.includes('Owner ID: 3467'));

        let lengthBefore = 0;
        let lengthAfter = 0;

        // 计算 "Owner ID: 3467" 点之前的长度
        for (let i = 0; i < centerIndex; i++) {
            const yearDiff = events[i + 1].start_time !== 'Unknown' && events[i].start_time !== 'Unknown'
                ? yearScale(events[i + 1].start_time - events[i].start_time)
                : UnknownLength;
            lengthBefore += yearDiff;
        }

        // 计算 "Owner ID: 3467" 点之后的长度
        for (let i = centerIndex; i < events.length - 1; i++) {
            const yearDiff = events[i + 1].start_time !== 'Unknown' && events[i].start_time !== 'Unknown'
                ? yearScale(events[i + 1].start_time - events[i].start_time)
                : UnknownLength;
            lengthAfter += yearDiff;
        }

        return {
            bookId,
            events,
            centerIndex,
            lengthBefore,
            lengthAfter
        };
    });

    const angleStep = (2 * Math.PI) / timelines.length;

    timelines.forEach((timeline, index) => {
        // 计算时间线的角度
        const angle = angleStep * index;
        const timelineClass = `class-timeline-${timeline.bookId}`;
        const textClass = `text-timeline-${timeline.bookId}`;

        // 计算左侧部分的起始点（从中心向左）
        const startLeftOffsetX = Math.cos(angle) * (timeline.lengthBefore + centerPadding);
        const startLeftOffsetY = Math.sin(angle) * (timeline.lengthBefore + centerPadding);
        const startLeftX = center.x - startLeftOffsetX;
        const startLeftY = center.y - startLeftOffsetY;

        // 计算右侧部分的结束点（从中心向右）
        const endRightOffsetX = Math.cos(angle) * (timeline.lengthAfter + centerPadding);
        const endRightOffsetY = Math.sin(angle) * (timeline.lengthAfter + centerPadding);
        const endRightX = center.x + endRightOffsetX;
        const endRightY = center.y + endRightOffsetY;

        // 绘制左侧部分的线段
        if (timeline.lengthBefore > 0) {
            const lineLeft = d3.line()([[startLeftX, startLeftY], [center.x, center.y]]);
            webSvg.append('path')
                .attr('d', lineLeft)
                .attr('class', timelineClass)
                .attr('opacity', 0.6)
                .attr('stroke', 'black')
                .attr('fill', 'none');
        }

        // 绘制右侧部分的线段
        const lineRight = d3.line()([[center.x, center.y], [endRightX, endRightY]]);
        webSvg.append('path')
            .attr('d', lineRight)
            .attr('class', timelineClass)
            .attr('opacity', 0.6)
            .attr('stroke', 'black')
            .attr('fill', 'none');



        let accumulatedLengthLeft = 0;
        for (let i = timeline.centerIndex - 1; i >= 0; i--) {
            accumulatedLengthLeft -= (timeline.events[i].start_time !== 'Unknown' && timeline.events[i + 1].start_time !== 'Unknown'
                ? yearScale(timeline.events[i + 1].start_time - timeline.events[i].start_time)
                : UnknownLength);

            const x = center.x + Math.cos(angle) * accumulatedLengthLeft;
            const y = center.y + Math.sin(angle) * accumulatedLengthLeft;

            timeline.events[i].owner_names.forEach(owner => {
                if (!ownerLocations[owner]) {
                    ownerLocations[owner] = [];
                }
                ownerLocations[owner].push({ x, y });
            });

            webSvg.selectAll(null) // 使用selectAll(null)来创建新的元素
                .data([timeline.events[i]]) // 绑定事件数据
                .enter()
                .append('circle')
                .attr('cx', x)
                .attr('cy', y)
                .attr('r', 2)
                .attr('fill', timeline.events[i].owner_names.includes('Owner ID: 3467') ? 'red' : 'blue')
                .on('mouseover', function() {
                    webTooltip.style('visibility', 'visible').text(`${timeline.events[i].owner_names.join(', ')}\nYear: ${timeline.events[i].start_time}`);
                })
                .on('mousemove', function(event) {
                    webTooltip.style('top', (event.pageY - 10) + 'px').style('left',(event.pageX + 10) + 'px');
                })
                .on('mouseout', function() {
                    webTooltip.style('visibility', 'hidden');
                });

            // 添加文本
            if (!timeline.events[i].owner_names.includes('Owner ID: 3467')) {
                webSvg.append('text')
                    .attr('class', `timeline-text ${textClass}`)
                    .attr('x', x)
                    .attr('y', y - 10)
                    .attr('text-anchor', 'middle')
                    .text(timeline.events[i].start_time);
            }
        }

        let accumulatedLengthRight = 0;
        for (let i = timeline.centerIndex; i < timeline.events.length; i++) {
            if (i !== timeline.centerIndex) {
                accumulatedLengthRight += (timeline.events[i].start_time !== 'Unknown' && timeline.events[i - 1].start_time !== 'Unknown'
                    ? yearScale(timeline.events[i].start_time - timeline.events[i - 1].start_time)
                    : UnknownLength);
            }

            const x = center.x + Math.cos(angle) * accumulatedLengthRight;
            const y = center.y + Math.sin(angle) * accumulatedLengthRight;

            timeline.events[i].owner_names.forEach(owner => {
                if (!ownerLocations[owner]) {
                    ownerLocations[owner] = [];
                }
                ownerLocations[owner].push({ x, y });
            });

            webSvg.selectAll(null)
                .data([timeline.events[i]]) // 绑定事件数据
                .enter()
                .append('circle')
                .attr('cx', x)
                .attr('cy', y)
                .attr('r', 2)
                .attr('fill', timeline.events[i].owner_names.includes('Owner ID: 3467') ? 'red' : 'blue')
                .on('mouseover', function() {
                    webTooltip.style('visibility', 'visible').text(`${timeline.events[i].owner_names.join(', ')}\nYear: ${timeline.events[i].start_time}`);
                })
                .on('mousemove', function(event) {
                    webTooltip.style('top', (event.pageY - 10) + 'px').style('left',(event.pageX + 10) + 'px');
                })
                .on('mouseout', function() {
                    webTooltip.style('visibility', 'hidden');
                });

            // 添加文本
            if (!timeline.events[i].owner_names.includes('Owner ID: 3467')) {
                webSvg.append('text')
                    .attr('class', `timeline-text ${textClass}`)
                    .attr('x', x)
                    .attr('y', y - 10)
                    .attr('text-anchor', 'middle')
                    .text(timeline.events[i].start_time);
            }
        }


        webSvg.selectAll(`.${timelineClass}`)
            .on('mouseover', function() {
                d3.selectAll(`.${timelineClass}`).attr('stroke', 'orange').attr('stroke-width', '2').attr('opacity', 1);
                webTooltip.style('visibility', 'visible').text(timeline.bookId);
                const isCheckboxChecked = showYearsCheckbox.checked;
                d3.selectAll('.timeline-text').style('opacity', function() {
                    if (isCheckboxChecked) {
                        return this.classList.contains(textClass) ? 1 : 0.1;
                    }
                    else {
                        return this.classList.contains(textClass) ? 1 : 0;
                    }
                });
            })
            .on('mousemove', function(event) {
                webTooltip.style('top', (event.pageY - 10) + 'px').style('left',(event.pageX + 10) + 'px');
            })
            .on('mouseout', function() {
                d3.selectAll(`.${timelineClass}`).attr('stroke', 'black').attr('stroke-width', '1').attr('opacity', 0.6);
                webTooltip.style('visibility', 'hidden');
                const isCheckboxChecked = showYearsCheckbox.checked;
                d3.selectAll('.timeline-text').style('opacity', isCheckboxChecked ? 1 : 0);
            });

    });

    // 在中心点添加共同所有者的标记
    webSvg.append('circle')
        .attr('cx', center.x)
        .attr('cy', center.y)
        .attr('r', 5)
        .attr('fill', 'red')
        .on('mouseover', function() {
            webTooltip.style('visibility', 'visible').text("Owner ID: 3467");
        })
        .on('mousemove', function(event) {
            webTooltip.style('top', (event.pageY - 10) + 'px').style('left',(event.pageX + 10) + 'px');
        })
        .on('mouseout', function() {
            webTooltip.style('visibility', 'hidden');
        });

    // 遍历每个所有者，连接最近的点
    Object.keys(ownerLocations).forEach(owner => {
        const locations = ownerLocations[owner];
        if (locations.length > 1) {
            locations.forEach((location, index) => {
                let closest = null;
                let closestDistance = Infinity;

                // 找到最近的点
                locations.forEach((otherLocation, otherIndex) => {
                    if (index !== otherIndex) {
                        const dist = distance(location, otherLocation);
                        if (dist < closestDistance) {
                            closest = otherLocation;
                            closestDistance = dist;
                        }
                    }
                });

                // 绘制连接最近点的虚线
                if (closest) {
                    webSvg.append('path')
                        .attr('class', 'linkSameOwner')
                        .attr('data-owner', owner)
                        .attr('opacity', 0.5)
                        .attr('d', d3.line()([[location.x, location.y], [closest.x, closest.y]]))
                        .attr('stroke', ownerColorScale(owner))
                        .attr('fill', 'none')
                        .on('mouseover', function() {
                            webTooltip.style('visibility', 'visible').text(`${owner}`);
                        })
                        .on('mousemove', function(event) {
                            webTooltip.style('top', (event.pageY - 10) + 'px').style('left',(event.pageX + 10) + 'px');
                        })
                        .on('mouseout', function() {
                            webTooltip.style('visibility', 'hidden');
                        });
                }
            });
        }
    });
    showOwnersCheckbox.checked = false;
    showSameOwnersCheckbox.checked = true;
    showYearsCheckbox.checked = true;
    Array.from(ownerCheckboxesContainer.querySelectorAll('input[type="checkbox"]')).forEach(checkbox => {
        checkbox.checked = true; // 设置所有所有者复选框为勾选状态
    });
    ownerCheckboxesContainer.style.display = showSameOwnersCheckbox.checked ? 'block' : 'none';
    ownerSearchBar.style.display = showSameOwnersCheckbox.checked ? 'block' : 'none';
    selectAllButton.style.display = showSameOwnersCheckbox.checked ? 'block' : 'none';
    deselectAllButton.style.display = showSameOwnersCheckbox.checked ? 'block' : 'none';
}

// 当页面加载完成时执行初始化函数
document.addEventListener('DOMContentLoaded', initialize);

